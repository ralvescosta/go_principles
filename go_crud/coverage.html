
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>books: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">crud/src/applications/books/books.go (72.0%)</option>
				
				<option value="file1">crud/src/frameworks/adapters/mux_middleware_adapt.go (66.7%)</option>
				
				<option value="file2">crud/src/frameworks/adapters/mux_router_adapt.go (63.6%)</option>
				
				<option value="file3">crud/src/frameworks/repositories/books_repository.go (80.3%)</option>
				
				<option value="file4">crud/src/interfaces/controllers/create_book_controller.go (100.0%)</option>
				
				<option value="file5">crud/src/interfaces/controllers/delete_book_controller.go (100.0%)</option>
				
				<option value="file6">crud/src/interfaces/controllers/index_book_controller.go (90.0%)</option>
				
				<option value="file7">crud/src/interfaces/controllers/show_book_controller.go (85.7%)</option>
				
				<option value="file8">crud/src/interfaces/controllers/update_book_controller.go (100.0%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package books

import (
        errors "crud/src/__core__/errors"
        entities "crud/src/business/entities"
        repositories "crud/src/frameworks/repositories"
)

type usecase struct {
        repository repositories.IBooksRepository
}

func (u *usecase) RegisterABook(book *entities.InputCreateBook) (*entities.BookEntity, error) <span class="cov8" title="1">{

        result, err := u.repository.Create(book)
        if err != nil </span><span class="cov0" title="0">{
                return nil, &amp;errors.InternalServerError{}
        }</span>

        <span class="cov8" title="1">return result, nil</span>
}

func (u *usecase) FindABook(id uint64) (*entities.BookEntity, error) <span class="cov8" title="1">{

        result, err := u.repository.FindByID(id)

        if err != nil &amp;&amp; err.Error() == "sql: no rows in result set" </span><span class="cov0" title="0">{
                return nil, nil
        }</span>
        <span class="cov8" title="1">if err != nil </span><span class="cov0" title="0">{
                return nil, &amp;errors.InternalServerError{}
        }</span>

        <span class="cov8" title="1">return result, nil</span>
}

func (u *usecase) GetAllBooks() (*[]entities.BookEntity, error) <span class="cov8" title="1">{

        result, err := u.repository.FindAll()

        if err != nil &amp;&amp; err.Error() == "sql: no rows in result set" </span><span class="cov0" title="0">{
                return nil, nil
        }</span>
        <span class="cov8" title="1">if err != nil </span><span class="cov0" title="0">{
                return nil, &amp;errors.InternalServerError{}
        }</span>

        <span class="cov8" title="1">return result, nil</span>
}

func (u *usecase) UpdateABook(id uint64, book *entities.InputCreateBook) (*entities.BookEntity, error) <span class="cov8" title="1">{

        result, err := u.repository.Update(id, book)
        if err != nil </span><span class="cov0" title="0">{
                return nil, &amp;errors.InternalServerError{}
        }</span>

        <span class="cov8" title="1">return result, nil</span>
}

func (u *usecase) DeleteABook(id uint64) (*entities.BookEntity, error) <span class="cov8" title="1">{

        result, err := u.repository.Delete(id)
        if err != nil </span><span class="cov0" title="0">{
                return nil, &amp;errors.InternalServerError{}
        }</span>

        <span class="cov8" title="1">return result, nil</span>
}

// Books ...
func Books(repository repositories.IBooksRepository) IBooks <span class="cov8" title="1">{
        return &amp;usecase{repository: repository}
}</span>
</pre>
		
		<pre class="file" id="file1" style="display: none">package adapters

import (
        core "crud/src/__core__"

        "net/http"
)

// MiddlewareAdapt ...
func MiddlewareAdapt(middleware core.IMiddleware) func(next http.Handler) http.Handler <span class="cov8" title="1">{
        return func(next http.Handler) http.Handler </span><span class="cov8" title="1">{

                return http.HandlerFunc(func(res http.ResponseWriter, req *http.Request) </span><span class="cov0" title="0">{

                        middleware.Handle(&amp;core.HTTPMiddleware{
                                Req:  req,
                                Res:  res,
                                Next: next,
                        })

                }</span>)
        }
}
</pre>
		
		<pre class="file" id="file2" style="display: none">package adapters

import (
        core "crud/src/__core__"

        "encoding/json"
        "net/http"

        "github.com/gorilla/mux"
)

// RouteAdapt ...
func RouteAdapt(controller core.IController, body interface{}) func(res http.ResponseWriter, req *http.Request) <span class="cov8" title="1">{
        return func(res http.ResponseWriter, req *http.Request) </span><span class="cov8" title="1">{

                if body != nil </span><span class="cov0" title="0">{
                        err := json.NewDecoder(req.Body).Decode(body)
                        if err != nil </span><span class="cov0" title="0">{
                                return
                        }</span>
                }

                <span class="cov8" title="1">vars := mux.Vars(req)

                httpRequest := &amp;core.HTTPRequest{
                        Body:   body,
                        Params: vars,
                }

                result := controller.Handle(httpRequest)

                res.WriteHeader(result.StatusCode)
                if result.Body != nil </span><span class="cov0" title="0">{
                        json.NewEncoder(res).Encode(result.Body)
                }</span>
        }
}
</pre>
		
		<pre class="file" id="file3" style="display: none">package repositories

import (
        entities "crud/src/business/entities"
        "database/sql"
        "fmt"
)

type booksRepository struct {
        db *sql.DB
}

// Create ...
func (b *booksRepository) Create(book *entities.InputCreateBook) (*entities.BookEntity, error) <span class="cov8" title="1">{
        sql := "INSERT INTO books (title, author, publishing_company, edition) VALUES (?, ?, ?, ?) RETURNING *"

        prepare, err := b.db.Prepare(sql)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov8" title="1">entity := &amp;entities.BookEntity{}
        err = prepare.QueryRow(
                book.Title,
                book.Author,
                book.PublishingCompany,
                book.Edition,
        ).Scan(
                &amp;entity.ID,
                &amp;entity.Title,
                &amp;entity.Author,
                &amp;entity.PublishingCompany,
                &amp;entity.Edition,
                &amp;entity.CreatedAt,
                &amp;entity.UpdatedAt,
                &amp;entity.DeletedAt,
        )
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov8" title="1">return entity, nil</span>
}

// FindByID ...
func (b *booksRepository) FindByID(id uint64) (*entities.BookEntity, error) <span class="cov8" title="1">{
        sql := "SELECT id, title, author, publishing_company, edition, created_at, updated_at, deleted_at FROM books WHERE id = ?"

        prepare, err := b.db.Prepare(sql)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov8" title="1">entity := &amp;entities.BookEntity{}
        err = prepare.QueryRow(id).Scan(
                &amp;entity.ID,
                &amp;entity.Title,
                &amp;entity.Author,
                &amp;entity.PublishingCompany,
                &amp;entity.Edition,
                &amp;entity.CreatedAt,
                &amp;entity.UpdatedAt,
                &amp;entity.DeletedAt,
        )

        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov8" title="1">return entity, nil</span>
}

// FindAll ...
func (b *booksRepository) FindAll() (*[]entities.BookEntity, error) <span class="cov8" title="1">{
        sql := "SELECT id, title, author, publishing_company, edition, created_at, updated_at, deleted_at FROM books"

        entity := entities.BookEntity{}
        entitySlice := []entities.BookEntity{}

        rows, err := b.db.Query(sql)

        for rows.Next() </span><span class="cov8" title="1">{
                err = rows.Scan(
                        &amp;entity.ID,
                        &amp;entity.Title,
                        &amp;entity.Author,
                        &amp;entity.PublishingCompany,
                        &amp;entity.Edition,
                        &amp;entity.CreatedAt,
                        &amp;entity.UpdatedAt,
                        &amp;entity.DeletedAt,
                )
                entitySlice = append(entitySlice, entity)

                if err != nil </span><span class="cov0" title="0">{
                        break</span>
                }
        }

        <span class="cov8" title="1">if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov8" title="1">return &amp;entitySlice, nil</span>
}

// Update ...
func (b *booksRepository) Update(id uint64, book *entities.InputCreateBook) (*entities.BookEntity, error) <span class="cov8" title="1">{
        var set string

        if book.Author != "" </span><span class="cov8" title="1">{
                set += fmt.Sprintf("author = '%s', ", book.Author)
        }</span>
        <span class="cov8" title="1">if book.Edition != 0 </span><span class="cov8" title="1">{
                set += fmt.Sprintf("edition = %d, ", book.Edition)
        }</span>
        <span class="cov8" title="1">if book.PublishingCompany != "" </span><span class="cov8" title="1">{
                set += fmt.Sprintf("publishing_company = '%s', ", book.PublishingCompany)
        }</span>
        <span class="cov8" title="1">if book.Title != "" </span><span class="cov8" title="1">{
                set += fmt.Sprintf("title = '%s', ", book.Title)
        }</span>

        <span class="cov8" title="1">set = set[:len(set)-2]
        sql := "UPDATE books SET " + set + " WHERE id = ? RETURNING *"

        prepare, err := b.db.Prepare(sql)
        if err != nil </span><span class="cov0" title="0">{
                fmt.Println(sql, err)
                return nil, err
        }</span>

        <span class="cov8" title="1">entity := &amp;entities.BookEntity{}
        err = prepare.QueryRow(id).Scan(
                &amp;entity.ID,
                &amp;entity.Title,
                &amp;entity.Author,
                &amp;entity.PublishingCompany,
                &amp;entity.Edition,
                &amp;entity.CreatedAt,
                &amp;entity.UpdatedAt,
                &amp;entity.DeletedAt,
        )
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov8" title="1">return entity, nil</span>
}

// Delete ...
func (b *booksRepository) Delete(id uint64) (*entities.BookEntity, error) <span class="cov8" title="1">{
        sql := "DELETE FROM books WHERE id = ? RETURNING *"

        prepare, err := b.db.Prepare(sql)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov8" title="1">entity := &amp;entities.BookEntity{}
        err = prepare.QueryRow(id).Scan(
                &amp;entity.ID,
                &amp;entity.Title,
                &amp;entity.Author,
                &amp;entity.PublishingCompany,
                &amp;entity.Edition,
                &amp;entity.CreatedAt,
                &amp;entity.UpdatedAt,
                &amp;entity.DeletedAt,
        )
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov8" title="1">return entity, nil</span>
}

// Delete ...
func (b *booksRepository) SoftDelete(id uint64) (*entities.BookEntity, error) <span class="cov0" title="0">{

        return nil, nil
}</span>

// BooksRepository ...
func BooksRepository(db *sql.DB) IBooksRepository <span class="cov8" title="1">{
        return &amp;booksRepository{db: db}
}</span>
</pre>
		
		<pre class="file" id="file4" style="display: none">package controllers

import (
        "net/http"

        core "crud/src/__core__"
        applications "crud/src/applications/books"
        entities "crud/src/business/entities"
)

// Controller ...
type createBookController struct {
        usecase applications.IBooks
}

// Handle ...
func (c *createBookController) Handle(httpRequest *core.HTTPRequest) *core.HTTPResponse <span class="cov8" title="1">{
        castBody := httpRequest.Body.(*entities.InputCreateBook)

        _, err := c.usecase.RegisterABook(castBody)

        if err != nil </span><span class="cov8" title="1">{
                return &amp;core.HTTPResponse{
                        StatusCode: http.StatusInternalServerError,
                }
        }</span>

        <span class="cov8" title="1">return &amp;core.HTTPResponse{
                StatusCode: http.StatusCreated,
        }</span>
}

// CreateABookController ...
func CreateABookController(usecase applications.IBooks) core.IController <span class="cov8" title="1">{
        return &amp;createBookController{usecase: usecase}
}</span>
</pre>
		
		<pre class="file" id="file5" style="display: none">package controllers

import (
        "net/http"
        "strconv"

        core "crud/src/__core__"
        applications "crud/src/applications/books"
)

// Controller ...
type deleteBookController struct {
        usecase applications.IBooks
}

// Handle ...
func (c *deleteBookController) Handle(httpRequest *core.HTTPRequest) *core.HTTPResponse <span class="cov8" title="1">{
        id, err := strconv.ParseUint(httpRequest.Params["id"], 10, 64)
        if err != nil </span><span class="cov8" title="1">{
                return &amp;core.HTTPResponse{
                        StatusCode: http.StatusInternalServerError,
                }
        }</span>

        <span class="cov8" title="1">_, err = c.usecase.DeleteABook(id)
        if err != nil </span><span class="cov8" title="1">{
                return &amp;core.HTTPResponse{
                        StatusCode: http.StatusInternalServerError,
                }
        }</span>

        <span class="cov8" title="1">return &amp;core.HTTPResponse{
                StatusCode: http.StatusOK,
        }</span>
}

// DeleteABookController ...
func DeleteABookController(usecase applications.IBooks) core.IController <span class="cov8" title="1">{
        return &amp;deleteBookController{usecase: usecase}
}</span>
</pre>
		
		<pre class="file" id="file6" style="display: none">package controllers

import (
        core "crud/src/__core__"
        applications "crud/src/applications/books"
        "net/http"
        "strconv"
)

// Controller ...
type indexBookController struct {
        usecase applications.IBooks
}

// Handle ...
func (c *indexBookController) Handle(httpRequest *core.HTTPRequest) *core.HTTPResponse <span class="cov8" title="1">{
        id, err := strconv.ParseUint(httpRequest.Params["id"], 10, 64)
        if err != nil </span><span class="cov8" title="1">{
                return &amp;core.HTTPResponse{
                        StatusCode: http.StatusInternalServerError,
                }
        }</span>

        <span class="cov8" title="1">result, err := c.usecase.FindABook(id)

        if err != nil </span><span class="cov8" title="1">{
                return &amp;core.HTTPResponse{
                        StatusCode: http.StatusInternalServerError,
                }
        }</span>

        <span class="cov8" title="1">if result == nil </span><span class="cov0" title="0">{
                return &amp;core.HTTPResponse{
                        StatusCode: http.StatusNotFound,
                }
        }</span>

        <span class="cov8" title="1">return &amp;core.HTTPResponse{
                StatusCode: http.StatusOK,
                Body:       result,
        }</span>
}

// IndexBookController ...
func IndexBookController(usecase applications.IBooks) core.IController <span class="cov8" title="1">{
        return &amp;indexBookController{usecase: usecase}
}</span>
</pre>
		
		<pre class="file" id="file7" style="display: none">package controllers

import (
        "net/http"

        core "crud/src/__core__"
        applications "crud/src/applications/books"
)

// Controller ...
type showBookController struct {
        usecase applications.IBooks
}

// Handle ...
func (c *showBookController) Handle(httpRequest *core.HTTPRequest) *core.HTTPResponse <span class="cov8" title="1">{

        result, err := c.usecase.GetAllBooks()
        if err != nil </span><span class="cov8" title="1">{
                return &amp;core.HTTPResponse{
                        StatusCode: http.StatusInternalServerError,
                }
        }</span>

        <span class="cov8" title="1">if result == nil </span><span class="cov0" title="0">{
                return &amp;core.HTTPResponse{
                        StatusCode: http.StatusNotFound,
                }
        }</span>

        <span class="cov8" title="1">return &amp;core.HTTPResponse{
                StatusCode: http.StatusOK,
                Body:       result,
        }</span>
}

// ShowBookController ...
func ShowBookController(usecase applications.IBooks) core.IController <span class="cov8" title="1">{
        return &amp;showBookController{usecase: usecase}
}</span>
</pre>
		
		<pre class="file" id="file8" style="display: none">package controllers

import (
        "net/http"
        "strconv"

        core "crud/src/__core__"
        applications "crud/src/applications/books"
        entities "crud/src/business/entities"
)

// Controller ...
type updateBookController struct {
        usecase applications.IBooks
}

// Handle ...
func (c *updateBookController) Handle(httpRequest *core.HTTPRequest) *core.HTTPResponse <span class="cov8" title="1">{
        id, err := strconv.ParseUint(httpRequest.Params["id"], 10, 64)
        if err != nil </span><span class="cov8" title="1">{
                return &amp;core.HTTPResponse{
                        StatusCode: http.StatusInternalServerError,
                }
        }</span>
        <span class="cov8" title="1">castBody := httpRequest.Body.(*entities.InputCreateBook)

        result, err := c.usecase.UpdateABook(id, castBody)
        if err != nil </span><span class="cov8" title="1">{
                return &amp;core.HTTPResponse{
                        StatusCode: http.StatusInternalServerError,
                }
        }</span>

        <span class="cov8" title="1">return &amp;core.HTTPResponse{
                StatusCode: http.StatusOK,
                Body:       result,
        }</span>
}

// UpdateBookController ...
func UpdateBookController(usecase applications.IBooks) core.IController <span class="cov8" title="1">{
        return &amp;updateBookController{usecase: usecase}
}</span>
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
